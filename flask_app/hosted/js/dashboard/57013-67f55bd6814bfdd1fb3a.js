!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="f5e957e4-cb08-4124-9ea8-0a826a56414c",e._sentryDebugIdIdentifier="sentry-dbid-f5e957e4-cb08-4124-9ea8-0a826a56414c")}catch(e){}}(),(self.webpackChunktwitch_twilight=self.webpackChunktwitch_twilight||[]).push([[57013],{974558:function(e){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"PurchaseOrderSuccessSnackbar"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelID"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bitsBalance"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bitsOffers"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bits"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"channel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"channelID"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]}]}}]}}]};function i(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var r=e.type;"NamedType"===r.kind&&n.add(r.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,n)})),e.definitions&&e.definitions.forEach((function(e){i(e,n)}))}var r={};n.definitions.forEach((function(e){if(e.name){var n=new Set;i(e,n),r[e.name.value]=n}})),e.exports=n},848132:function(e,n,i){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"PurchaseOrderContextGetPurchaseOrder"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"purchaseOrderID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"purchaseOrder"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"purchaseOrderID"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"purchaseOrder"},directives:[]}]}}]}}]}}]},a={};function t(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&n.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){t(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){t(e,n)})),e.definitions&&e.definitions.forEach((function(e){t(e,n)}))}r.definitions=r.definitions.concat(i(720937).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var n=e.name.value;return!a[n]&&(a[n]=!0,!0)})));var o={};r.definitions.forEach((function(e){if(e.name){var n=new Set;t(e,n),o[e.name.value]=n}})),e.exports=r},150059:function(e,n,i){var r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PurchaseOrderContext_PurchaseOffer"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PurchaseOfferInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"purchaseOffer"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"purchaseOrder"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"purchaseOrder"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"error"},arguments:[],directives:[]}]}}]}}]},a={};function t(e,n){if("FragmentSpread"===e.kind)n.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&n.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){t(e,n)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){t(e,n)})),e.definitions&&e.definitions.forEach((function(e){t(e,n)}))}r.definitions=r.definitions.concat(i(720937).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var n=e.name.value;return!a[n]&&(a[n]=!0,!0)})));var o={};r.definitions.forEach((function(e){if(e.name){var n=new Set;t(e,n),o[e.name.value]=n}})),e.exports=r},720937:function(e){e.exports={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"purchaseOrder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PurchaseOrder"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"actionTokenID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"failureReason"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}},432927:function(e,n,i){"use strict";i.d(n,{X:function(){return o}});var r=i(407827),a=i(178196),t=r.x.wrap((function(){return Promise.all([i.e(7595),i.e(12039),i.e(13303),i.e(56450),i.e(59147),i.e(21745),i.e(98922),i.e(27047),i.e(16001),i.e(33768),i.e(97201),i.e(87051),i.e(4098),i.e(97943),i.e(17094),i.e(99351)]).then(i.bind(i,830544))}),"CheckoutFormModal");function o(e){return function(n){n((0,a.to)(t,e))}}},557013:function(e,n,i){"use strict";i.d(n,{_O:function(){return V},eQ:function(){return M},EV:function(){return Q}});var r=i(331635),a=i(474848),t=i(296540),o=i(415044),s=i(407827),u=i(783321),d=i(503472),c=i(178196),l=i(267924),v=i(397568),f=i(235461),m=i(868238),h=i(346716),k=i(432927),p=i(706439),S=i(942086),b="purchase-order-failure-snackbar";var g=(0,m.Zz)((0,o.Ng)(null,(function(e){return(0,m.zH)({showCheckoutModal:k.X},e)})))((function(e){var n=e.checkoutFormProps,r=e.charityCheckoutFormProps,t=e.showCheckoutModal,u=(0,o.wA)(),d=s.x.wrap((function(){return Promise.all([i.e(6799),i.e(21745),i.e(16001),i.e(33768),i.e(17523),i.e(35498)]).then(i.bind(i,17523))}),"CharityCheckoutModal"),l=r?(0,h.hw)("Donation could not be completed.","PurchaseOrderErrorSnackbar"):(0,h.hw)("Purchase could not be completed.","PurchaseOrderErrorSnackbar"),v=(0,h.hw)("{purchaseTypeMessage} There was an error during the order.",{purchaseTypeMessage:l},"PurchaseOrderErrorSnackbar");return n&&(0,S.d$)("complete_purchase_checkout_failure"),(0,a.jsx)(p.D,{id:b,type:"warning",message:v,buttonProps:{children:(0,h.hw)("Open Checkout","PurchaseOrderErrorSnackbar"),onClick:function(){return n?t(n):r?u((0,c.to)(d,r)):void 0}},margin:0})})),_=i(528267),O=i(906719),P=i(959340),y=i(914421),D=i(958007),N=i(211027),E=function(e){var n=e.tplr,i="";return n&&(N.mO.includes(n)?i=(0,h.hw)("Subscription","PurchaseOrderProcessingSnackbar"):N._z.includes(n)?i=(0,h.hw)("Gift","PurchaseOrderProcessingSnackbar"):n===N.nk.BitsBundle?i=(0,h.hw)("Bits","PurchaseOrderProcessingSnackbar"):n===N.nk.Charity&&(i=(0,h.hw)("donation","PurchaseOrderProcessingSnackbar"))),(0,a.jsx)(_.q,{type:O.v.InfoLoading,message:(0,a.jsx)(P.P,{display:y.nl.Flex,alignItems:y.k2.Center,children:(0,a.jsx)(P.P,{flexGrow:1,textAlign:y.nO.Left,children:(0,a.jsx)(D.z,{title:(0,h.hw)("Payment Processing. Your {description} order will be completed soon.",{description:i},"PurchaseOrderProcessingSnackbar")})})})})},w=i(974558),I=i.n(w),F="purchase-order-success-snackbar";var C,T=function(e){var n,i,r=e.channelID,t=e.offerID,o=e.tplr,s=e.additionalSnackbarContent,d=e.checkoutSessionTracker,c=(0,u.IT)(I(),{variables:{channelID:r}}),l=c.data,v=c.loading,m=(null===(n=null==l?void 0:l.channel)||void 0===n?void 0:n.name)||"",k=(0,h.ZV)((null===(i=null==l?void 0:l.currentUser)||void 0===i?void 0:i.bitsBalance)||0),S=function(e,n){var i,r;return(null===(i=null==e?void 0:e.currentUser)||void 0===i?void 0:i.bitsOffers)?null===(r=null==e?void 0:e.currentUser)||void 0===r?void 0:r.bitsOffers.find((function(e){return!(!e||e.id!==n)})):null}(l,t),b=(0,h.ZV)(S?S.bits:0),g="";if(o)if(o===N.nk.BitsBundle){if(d&&b===(0,h.ZV)(0)){var _="";l?l.currentUser?l.currentUser.bitsOffers?void 0===S&&(_="Current user does not have offer that matches with offerId ".concat(t)):_="Current user does not have any bits offers":_="Current user data is missing":_="Data is undefined",d.track({subEvent:f.N.ZeroBits,subEventDetail:JSON.stringify({error:_})})}var O=(0,h.hw)("{balance, plural, one {Your total is {balance} bit.} other {Your total is {balance} bits.}}",{balance:k},"PurchaseOrderSuccessSnackbar");g=(0,h.hw)("{quantity, plural, one {{quantity} bit has been added to your balance! {balanceString}} other {{quantity} bits have been added to your balance! {balanceString}}}",{quantity:b,balanceString:O},"PurchaseOrderSuccessSnackbar")}else N.mO.includes(o)?g=(0,h.hw)("Thank you for subscribing to {channel}!",{channel:m},"PurchaseOrderSuccessSnackbar"):N._z.includes(o)?g=(0,h.hw)("Thank you for gifting to {channel}!",{channel:m},"PurchaseOrderSuccessSnackbar"):o===N.nk.Charity&&(g=(0,h.hw)("Thank you for your {amount} donation to support {charityName}!",{charityName:(null==s?void 0:s.charityName)||"",amount:(null==s?void 0:s.amountSpent)||""},"PurchaseOrderSuccessSnackbar"));var P=o===N.nk.Charity?(0,h.hw)("{actionMessage} Your donation confirmation will be sent to {userEmail}.",{actionMessage:g,userEmail:(null==s?void 0:s.userEmail)||""},"PurchaseOrderSuccessSnackbar"):(0,h.hw)("{actionMessage} Your receipt will be sent to your email.",{actionMessage:g},"PurchaseOrderSuccessSnackbar");return!v&&(0,a.jsx)(p.D,{id:F,type:"success",dismissable:!0,message:(0,a.jsx)(D.z,{title:P}),margin:0})||null},R=i(606127),x=i(848132),A=i.n(x),L=i(150059),U=i.n(L),V=(C=(0,v.q)("PurchaseOrderContext",{purchaseOffer:function(){return(0,r.__awaiter)(void 0,void 0,void 0,(function(){return(0,r.__generator)(this,(function(e){return[2,Promise.resolve({data:{purchaseOffer:null}})]}))}))}})).context,M=C.withContext,B={API_BASE_URL:void 0,CDN_URL:"https://assets.twitch.tv/",GQL_BASE_URL:void 0,PASSPORT_BASE_URL:void 0,INTERPOL_BASE_URL:void 0,PUBSUB_ENV:void 0,TMI_BASE_URL:void 0,MANIFEST_URL:"https://assets.twitch.tv/config/manifest.json?v=1",NODE_ENV:"production",PLAYER_BASE_URL:"https://player.twitch.tv",SITE_NAME:void 0,IS_DEV_BUILD:!1,IS_STAGING_BUILD:!1,IS_LOCAL_DEVSERVER:!1}.IS_MOBILE_PORTAL?function(){throw Error("NotSupported")}:s.x.wrap((function(){return Promise.all([i.e(7595),i.e(12039),i.e(13303),i.e(56450),i.e(59147),i.e(21745),i.e(98922),i.e(27047),i.e(16001),i.e(33768),i.e(97201),i.e(87051),i.e(4098),i.e(97943),i.e(17094),i.e(99351)]).then(i.bind(i,830544))}),"CheckoutFormModal"),j=function(e){var n,i,s,v,m,h,k,p,S,_,O,P=e.children,y=(0,o.wA)(),D=(0,t.useState)(null),w=D[0],I=D[1],C=(0,t.useState)(null),x=C[0],L=C[1],M=(0,t.useState)(null),j=M[0],Q=M[1],q=(0,t.useState)(null),G=q[0],Y=q[1],z=(0,t.useState)(null),Z=z[0],H=z[1],J=null===(i=null===(n=null==Z?void 0:Z.purchaseOffer)||void 0===n?void 0:n.purchaseOrder)||void 0===i?void 0:i.id,X=null===(s=null==Z?void 0:Z.purchaseOffer)||void 0===s?void 0:s.error,$=(0,t.useRef)(null),K=(0,t.useContext)(R.xG),W=K.addSnackbarToQueue,ee=K.removeSnackbarFromQueue,ne=(0,u.n_)(U())[0],ie=(0,u.IT)(A(),{variables:{purchaseOrderID:J},skip:!J}),re=ie.data,ae=ie.startPolling,te=ie.stopPolling,oe=null===(v=null==re?void 0:re.currentUser)||void 0===v?void 0:v.purchaseOrder,se=null===(h=null===(m=null==re?void 0:re.currentUser)||void 0===m?void 0:m.purchaseOrder)||void 0===h?void 0:h.state,ue=null===(p=null===(k=null==re?void 0:re.currentUser)||void 0===k?void 0:k.purchaseOrder)||void 0===p?void 0:p.actionTokenID,de=null===(_=null===(S=null==re?void 0:re.currentUser)||void 0===S?void 0:S.purchaseOrder)||void 0===_?void 0:_.failureReason,ce=(0,t.useState)(null),le=ce[0],ve=ce[1],fe=(0,t.useState)(""),me=fe[0],he=fe[1],ke=(0,t.useState)(""),pe=ke[0],Se=ke[1],be=(0,t.useState)(),ge=be[0],_e=be[1],Oe=(0,t.useState)(!1),Pe=Oe[0],ye=Oe[1],De=(0,t.useState)(void 0),Ne=De[0],Ee=De[1],we=(0,t.useCallback)((function(e,n,i,t,o,s,u,c){return(0,r.__awaiter)(void 0,void 0,void 0,(function(){var l,v,f,m,h,k,p,S;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:if(se&&!N.QA.includes(se)&&!pe)return[2,Promise.reject(new Error("There is already a processing order"))];r.label=1;case 1:return r.trys.push([1,3,,4]),null==c||c({isProcessing:!0,orderState:void 0,purchaseOfferErrorCode:void 0,orderFailureReason:void 0}),ye(!!u),I(e),L(t||null),Q(o||null),Y(s||null),H(null),ee(F),ee(b),[4,ne((0,d.AR)(e))];case 2:return l=r.sent(),H(null!==(m=l.data)&&void 0!==m?m:{purchaseOffer:null}),(null===(k=null===(h=l.data)||void 0===h?void 0:h.purchaseOffer)||void 0===k?void 0:k.error)&&Ee(l.data.purchaseOffer.error),(null===(S=null===(p=l.data)||void 0===p?void 0:p.purchaseOffer)||void 0===S?void 0:S.purchaseOrder)&&(v=l.data.purchaseOffer.purchaseOrder.id,ve(n),he(i),ae(1e3),_e((function(){return c})),W((0,a.jsx)(E,{tplr:n}),{itemID:v,throttleMS:0}),$.current=setTimeout((function(){te(),null==c||c({isProcessing:!1,orderState:l.data.purchaseOffer.purchaseOrder.state,purchaseOfferErrorCode:void 0,orderFailureReason:void 0})}),6e4)),[2,Promise.resolve(l)];case 3:return f=r.sent(),null==c||c({isProcessing:!1,orderState:void 0,purchaseOfferErrorCode:void 0,orderFailureReason:void 0}),[2,Promise.reject(f)];case 4:return[2]}}))}))}),[pe,W,ne,se,ee,ae,te]),Ie=t.useCallback((function(e){y((0,c.to)(B,e))}),[y]);(0,t.useEffect)((function(){if(Ne&&Pe&&x){var e=(0,r.__assign)((0,r.__assign)({},x),{purchaseOfferErrorCode:null!=Ne?Ne:void 0});Ie(e)}}),[x,Pe,Ie,Ne]),(0,t.useEffect)((function(){J&&oe&&oe.id===J&&se===l.dFc.THREE_D_SECURE_CHALLENGE_REQUIRED&&ue&&pe!==ue&&(x||j)&&(te(),ee(J),null==ge||ge({isProcessing:!1,orderState:se,purchaseOfferErrorCode:void 0,orderFailureReason:void 0}),$.current&&clearInterval($.current),Se(ue),Pe&&x?Ie((0,r.__assign)((0,r.__assign)({},x),{threeDSActionTokenID:ue})):W((0,a.jsx)(g,{checkoutFormProps:x?(0,r.__assign)((0,r.__assign)({},x),{threeDSActionTokenID:ue}):void 0,charityCheckoutFormProps:j||void 0}),{itemID:b,throttleMS:0}))}),[ue,pe,W,j,x,Pe,Ie,oe,J,se,ee,ge,te]),(0,t.useEffect)((function(){var e,n,i,t;if((null==w?void 0:w.offerID)&&oe&&J&&oe.id===J&&se&&N.QA.includes(se))if(te(),null==ge||ge({isProcessing:!1,orderState:se}),ee(J),Se(""),$.current&&clearInterval($.current),N._s.includes(se)){if(null===(e=null==x?void 0:x.checkoutSessionTracker)||void 0===e||e.track({subEvent:f.N.CompletePurchaseClickSuccess,originID:J}),j){var o=(null===(n=w.paymentInstrument)||void 0===n?void 0:n.method)===l.Q30.PAYPAL?"payment_succeed_paypal":"donate_now_attempt_success";j.donationSession.track(o,"",J)}W((0,a.jsx)(T,{channelID:me,offerID:w.offerID,tplr:le,additionalSnackbarContent:G||void 0,checkoutSessionTracker:null==x?void 0:x.checkoutSessionTracker}),{itemID:F,throttleMS:0}),window.dispatchEvent(new Event("successful-purchase-event"))}else if(x){null===(i=null==x?void 0:x.checkoutSessionTracker)||void 0===i||i.track({subEvent:f.N.CompletePurchaseClickFailure,subEventDetail:JSON.stringify({purchase_order_error:de||(X||"NO_ERROR_PO_POLLER")})}),null==ge||ge({isProcessing:!1,orderState:se,purchaseOfferErrorCode:null!=X?X:void 0,orderFailureReason:null!=de?de:void 0});var s=(0,r.__assign)((0,r.__assign)({},x),{purchaseOrderFailureReason:null!=de?de:void 0,purchaseOfferErrorCode:null!=X?X:void 0});Pe&&s?Ie(s):W((0,a.jsx)(g,{checkoutFormProps:s}),{itemID:b,throttleMS:0})}else if(j){o=(null===(t=w.paymentInstrument)||void 0===t?void 0:t.method)===l.Q30.PAYPAL?"payment_failure_paypal":"donate_now_attempt_failure";j.donationSession.track(o,JSON.stringify({purchase_order_error:de}),""),W((0,a.jsx)(g,{charityCheckoutFormProps:j}),{itemID:b,throttleMS:0})}return function(){$.current&&clearInterval($.current)}}),[W,me,j,x,Pe,Ie,X,null==w?void 0:w.offerID,null===(O=null==w?void 0:w.paymentInstrument)||void 0===O?void 0:O.method,oe,de,J,se,ee,ge,G,te,le]);var Fe={order:oe,purchaseOffer:we,offerTPLR:le};return(0,a.jsx)(V.Provider,{value:Fe,children:P})};function Q(e){return function(n){return(0,a.jsx)(j,{children:(0,a.jsx)(e,(0,r.__assign)({},n))})}}}}]);