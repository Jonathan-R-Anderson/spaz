<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gremlin Threads DApp</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://{{ request.host.split(':')[0] }}:5000{{ url_for('static', filename='styles/test.css') }}">

</head>
<body>
    <h1>Gremlin.Codes</h1>
    <!-- MetaMask Icon -->
    <div id="connectWalletIcon" style="display: none;">
        <img src="https://cdn.iconscout.com/icon/free/png-256/metamask-2728406-2261817.png" 
            alt="Connect MetaMask" 
            style="width: 50px; height: 50px; cursor: pointer;" 
            onclick="connectMetaMask()" />
    </div>

    <div id="status">Loading...</div>
    <button id="connectMetaMask">Connect MetaMask</button>

    <div class="navbar">Gremlin.Codes DApp</div>

    <div>
        <h3>User Tag Management</h3>
        <div>
            <!-- Radio buttons to toggle between whitelist and blacklist -->
            <input type="radio" id="whitelist" name="filterMode" value="whitelist" checked onchange="updateTagDisplay()">
            <label for="whitelist">Whitelist</label>
            <input type="radio" id="blacklist" name="filterMode" value="blacklist" onchange="updateTagDisplay()">
            <label for="blacklist">Blacklist</label>
        </div>
    
        <!-- Search bar to manually add tags -->
        <input type="text" id="searchBar" placeholder="Enter tag..." onkeypress="addTagOnEnter(event)" />
        <div id="searchTagsDisplay" style="margin-top: 10px;"></div>

        <div id="tagDisplayContainer">
            <h4 id="tagDisplayTitle">Current Whitelist:</h4>
            <ul id="tagDisplay"></ul> <!-- This will display either whitelist or blacklist based on the mode -->
        </div>
    </div>
    


    <button id="showOverlayBtn" onclick="showNewThreadOverlay()">Create Post</button>

    <!-- Admin Panel -->
    <div id="adminPanel">
        <h2>Admin Panel</h2>
    
        <!-- Section to delete posts by ID -->
        <div class="admin-controls">
            <button onclick="deletePostById()">Delete Post by ID</button>
            <input type="text" id="postIdToDelete" placeholder="Enter post ID" />
        </div>
    
        <!-- Blacklist/Whitelist Management -->
        <div class="admin-controls">
            <h3>Manage Tags</h3>
            <button onclick="addTagToBlacklist()">Blacklist Tag</button>
            <button onclick="addTagToWhitelist()">Whitelist Tag</button>
            <input type="text" id="tagToManage" placeholder="Enter tag to blacklist/whitelist" />
        </div>
    
        <div class="admin-controls">
            <h3>Manage Magnet URLs</h3>
            <button onclick="addMagnetToBlacklist()">Blacklist Magnet URL</button>
            <button onclick="addMagnetToWhitelist()">Whitelist Magnet URL</button>
            <input type="text" id="magnetToManage" placeholder="Enter magnet URL to blacklist/whitelist" />
        </div>
    
        <div class="admin-controls">
            <h3>Manage User Addresses</h3>
            <button onclick="addUserToBlacklist()">Blacklist User</button>
            <button onclick="addUserToWhitelist()">Whitelist User</button>
            <input type="text" id="userToManage" placeholder="Enter user address to blacklist/whitelist" />
        </div>
    
        <!-- Display current blacklists and whitelists -->
        <div class="admin-controls">
            <h4>Current Blacklist</h4>
            <ul id="blacklistDisplay"></ul>
    
            <h4>Current Whitelist</h4>
            <ul id="whitelistDisplay"></ul>
        </div>
    </div>

    <!-- Overlay for Thread Creation/Reply -->
    <div id="overlay">
        <div id="overlayContent">
            <h2 id="overlayTitle">Create a New Post</h2>
            <p id="replyContext" style="display: none;">Replying to: <span id="replyThreadTitle"></span></p> <!-- Added reply context -->

            <!-- Input for Post Title -->
            <input type="text" id="newPostTitle" placeholder="Title" style="width: 100%; padding: 10px;" />
        
            <!-- Input for Post Content -->
            <textarea id="newPostContent" placeholder="Content" style="width: 100%; padding: 10px; height: 100px;"></textarea>

            <!-- Input for Tags -->
            <input type="text" id="newPostTags" placeholder="Tags (comma-separated)" style="width: 100%; padding: 10px;" />

            <!-- Input for Email -->
            <input type="email" id="newPostEmail" placeholder="Your Email (optional)" style="width: 100%; padding: 10px;" />

            <!-- Input for File Upload -->
            <input type="file" id="imageUpload" accept="image/*" style="width: 100%; padding: 10px;" />
        
            <!-- Submit Button -->
            <button id="submitPostBtn" onclick="submitPost()">Submit Post</button>

            <!-- Formatting Guide -->
            <div id="formattingGuide" style="background-color: #000000; padding: 10px; border-radius: 5px;">
                <h4>Formatting Options</h4>
                <ul>
                    <li><strong>Bold:</strong> <code>**bold**</code></li>
                    <li><em>Italic:</em> <code>*italic*</code></li>
                    <li><u>Underline:</u> <code>~~underline~~</code></li>
                    <li><code>Code block:</code> <code>```code```</code></li>
                    <li>Link: <code>[text](url)</code></li>
                    <li>Lists: <code>- Item</code></li>
                    <li>Inline code: <code>`code`</code></li>
                </ul>
            </div>

            <!-- Cancel Button -->
            <button id="closeOverlayBtn" onclick="closeOverlay()">Cancel</button>
        </div>
    </div>


    <div id="infiniteScrollContent">
    </div>

    <script type='module'>
        import WebTorrent from 'https://esm.sh/webtorrent';
    </script>


</body>

<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/webtorrent/webtorrent.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/showdown/dist/showdown.min.js"></script> <!-- Include Showdown -->
<script src="https://cdn.jsdelivr.net/pyodide/v0.21.3/full/pyodide.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gsap@3.9.1/dist/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ext-language_tools.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.8/ext-settings_menu.min.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.7/underscore-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-cloud/build/d3.layout.cloud.min.js"></script>


<script>
    const _gremlinThreadABI = {{ gremlinThreadABI | safe }};
    const _gremlinThreadAddress = "{{ gremlinThreadAddress }}";
    const _gremlinReplyABI = {{ gremlinReplyABI | safe }};
    const _gremlinReplyAddress = "{{ gremlinReplyAddress }}";
    const _gremlinAdminABI = {{ gremlinAdminABI | safe }};
    const _gremlinAdminAddress = "{{ gremlinAdminAddress }}";
</script>

<script type="module" src="https://{{ request.host.split(':')[0] }}:5000{{ url_for('static', filename='js/test.js') }}"></script>

</html>
